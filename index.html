<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CDSO 신체 리소스 엔진 v2.0</title>
  <style>
    :root { --bg: #f8f9fa; --card: #ffffff; --primary: #2563eb; --hold: #dc2626; --go: #16a34a; }
    body{ font-family: system-ui, -apple-system, sans-serif; max-width: 800px; margin: 20px auto; padding: 0 15px; background: var(--bg); color: #1e293b; line-height: 1.5; }
    .card { background: var(--card); padding: 24px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); margin-bottom: 20px; }
    h2 { margin-top: 0; font-size: 1.25rem; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px; }
    label { display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 6px; }
    input, select { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
    button { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 12px; font-size: 1.125rem; font-weight: 700; cursor: pointer; transition: opacity 0.2s; }
    button:hover { opacity: 0.9; }
    .box { margin-top: 24px; white-space: pre-line; border-radius: 12px; padding: 20px; }
    .status-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-weight: 800; font-size: 1.25rem; margin-bottom: 12px; }
    .state-HOLD { background: #fee2e2; color: #991b1b; }
    .state-BUILD-B { background: #fef3c7; color: #92400e; }
    .state-BUILD-A { background: #dcfce7; color: #166534; }
    .state-GO { background: #dcfce7; color: #15803d; border: 2px solid #22c55e; }
    .warning-box { background: #fff7ed; border-left: 4px solid #f97316; padding: 12px; font-size: 0.9rem; margin-top: 10px; }
    .small-info { font-size: 0.8rem; color: #64748b; margin-top: 4px; }
  </style>
</head>

<body>
  <div class="card">
    <h2>[CDSO] 오늘의 신체 로그 입력</h2>
    <div class="grid">
      <div>
        <label>수면 점수 (Sleep)</label>
        <input id="sleep" type="number" value="75" />
        <div class="small-info">※ 70점 미만 시 고강도 운동 제한</div>
      </div>
      <div>
        <label>에너지 점수 (Energy)</label>
        <input id="energy" type="number" value="84" />
        <div class="small-info">※ 비타민 마스킹 주의</div>
      </div>
      <div>
        <label>어제 최고 심박수 (Max HR)</label>
        <input id="maxhr" type="number" value="140" placeholder="예: 192" />
        <div class="small-info">※ 170bpm 초과 시 경고</div>
      </div>
    </div>

    <div class="grid">
      <div>
        <label>어제 음주 여부</label>
        <select id="alcohol">
          <option value="no" selected>아니오</option>
          <option value="yes">예 (B군 소모 가속)</option>
        </select>
      </div>
      <div>
        <label>중요 이벤트(업무/미팅)</label>
        <select id="event">
          <option value="none" selected>없음</option>
          <option value="normal">보통 (회의 등)</option>
          <option value="critical">중요 (발표/면접)</option>
        </select>
      </div>
    </div>

    <button onclick="analyzeSystem()">시스템 분석 및 지침 출력</button>
  </div>

  <div id="resultCard" class="card" style="display:none;">
    <div id="statusBadge" class="status-badge">상태: -</div>
    <div id="outputBox" class="box"></div>
  </div>

<script>
const LS_KEY = "cdso_health_log_v2";

function analyzeSystem() {
  const data = {
    sleep: Number(document.getElementById("sleep").value),
    energy: Number(document.getElementById("energy").value),
    maxhr: Number(document.getElementById("maxhr").value),
    alcohol: document.getElementById("alcohol").value,
    event: document.getElementById("event").value,
    isWeekday: new Date().getDay() !== 0 && new Date().getDay() !== 6
  };

  // 1. 상태 판정 (Decision Tree)
  let state = "BUILD-A";
  let warnings = [];

  if (data.maxhr >= 180 || data.alcohol === "yes" && data.sleep < 70) {
    state = "HOLD";
    warnings.push("⚠️ 자율신경계 비상 상황! 심장과 간이 과부하 상태입니다.");
  } else if (data.sleep < 70) {
    state = "BUILD-B";
    warnings.push("⚠️ 수면 부족. 현재 에너지 점수는 비타민에 의한 착시일 확률이 높습니다.");
  } else if (data.sleep >= 80 && data.energy >= 85 && data.maxhr < 165) {
    state = "GO";
  } else if (data.sleep < 75) {
    state = "BUILD-B";
  }

  // 2. 비타민 전략
  let takeVitamin = false;
  let vitReason = "";
  if (state === "HOLD" && data.alcohol === "no") {
    takeVitamin = false; vitReason = "신경계 안정을 위해 휴식 우선";
  } else if (data.alcohol === "yes") {
    takeVitamin = true; vitReason = "알코올 해독 및 호모시스테인 방어 (필수)";
  } else if (data.event === "critical") {
    takeVitamin = true; vitReason = "중요 일정 퍼포먼스 지원";
  } else if (state === "GO" || (state === "BUILD-A" && data.isWeekday)) {
    takeVitamin = true; vitReason = "대사 활성화 및 호모시스테인 관리";
  }

  // 3. 운동 가이드
  let workout = { summary: "", detail: "", hrCap: 0 };
  if (state === "HOLD") {
    workout = { summary: "운동 전면 금지 (REST)", detail: "산책도 15분 이내로 제한. 오직 회복에 집중하십시오.", hrCap: 110 };
  } else if (state === "BUILD-B") {
    workout = { summary: "저강도 회복 활동", detail: "근력: 생략 / 유산소: 걷기 시속 5.0 고정 (절대 뛰지 말 것)", hrCap: 130 };
  } else if (state === "BUILD-A") {
    workout = { summary: "중등도 유지 운동", detail: "근력: 20분 (평소 70%) / 유산소: 조깅 시속 6.0 정속 (인터벌 금지)", hrCap: 145 };
  } else {
    workout = { summary: "고강도 출력 운동", detail: "근력: 30분 (정상) / 유산소: 30분 (시속 6.5~7.0 유지)", hrCap: 160 };
  }

  if (data.maxhr >= 170) {
    workout.detail += "\n❗어제 심박 스파이크가 확인되어 오늘 뛰기 속도를 -1.0 강제 조정합니다.";
    workout.hrCap -= 10;
  }

  // 출력
  const resCard = document.getElementById("resultCard");
  const badge = document.getElementById("statusBadge");
  const out = document.getElementById("outputBox");

  resCard.style.display = "block";
  badge.className = "status-badge state-" + state;
  badge.innerText = "Current Status: " + state;

  out.innerHTML = `
    <strong>💊 약물/비타민 전략</strong>
    - 혈압약(엑스닌): <b>매일 아침 고정 복용</b>
    - 비타민(비맥스): <b>${takeVitamin ? "✅ 복용 (점심 식후)" : "❌ 건너뛰기"}</b>
    - 근거: ${vitReason}

    <strong>🏃 운동 처방 (HR Cap: ${workout.hrCap} bpm)</strong>
    - 목표: ${workout.summary}
    - 상세: ${workout.detail}

    <strong>📉 리스크 관리</strong>
    ${warnings.map(w => `<div class="warning-box">${w}</div>`).join('')}
    - <b>CDSO Advice:</b> 오늘 최고 심박수를 <b>${workout.hrCap}bpm</b> 이하로 통제하여 혈관의 전단 응력을 최소화하십시오.
  `;
}
</script>
</body>
</html>